(function(){var k=function(h,m){var l={type:"uri"};"string"===typeof h?h={file:h,type:"uri"}:"undefined"!==typeof window&&window.File&&h instanceof window.File&&(h={file:h,type:"file"});for(var g in h)l[g]=h[g];if(!l.file)return m("No file was set");if("file"===l.type){if("undefined"===typeof window||!window.File||!window.FileReader||"undefined"===typeof ArrayBuffer)return m("Browser does not have support for the File API and/or ArrayBuffers")}else if("local"===l.type){if("function"!==typeof require)return m("Local paths may not be read within a browser");
var p=require("fs")}var k="Blues;Classic Rock;Country;Dance;Disco;Funk;Grunge;Hip-Hop;Jazz;Metal;New Age;Oldies;Other;Pop;R&B;Rap;Reggae;Rock;Techno;Industrial;Alternative;Ska;Death Metal;Pranks;Soundtrack;Euro-Techno;Ambient;Trip-Hop;Vocal;Jazz+Funk;Fusion;Trance;Classical;Instrumental;Acid;House;Game;Sound Clip;Gospel;Noise;AlternRock;Bass;Soul;Punk;Space;Meditative;Instrumental Pop;Instrumental Rock;Ethnic;Gothic;Darkwave;Techno-Industrial;Electronic;Pop-Folk;Eurodance;Dream;Southern Rock;Comedy;Cult;Gangsta Rap;Top 40;Christian Rap;Pop / Funk;Jungle;Native American;Cabaret;New Wave;Psychedelic;Rave;Showtunes;Trailer;Lo-Fi;Tribal;Acid Punk;Acid Jazz;Polka;Retro;Musical;Rock & Roll;Hard Rock;Folk;Folk-Rock;National Folk;Swing;Fast  Fusion;Bebob;Latin;Revival;Celtic;Bluegrass;Avantgarde;Gothic Rock;Progressive Rock;Psychedelic Rock;Symphonic Rock;Slow Rock;Big Band;Chorus;Easy Listening;Acoustic;Humour;Speech;Chanson;Opera;Chamber Music;Sonata;Symphony;Booty Bass;Primus;Porn Groove;Satire;Slow Jam;Club;Tango;Samba;Folklore;Ballad;Power Ballad;Rhythmic Soul;Freestyle;Duet;Punk Rock;Drum Solo;A Cappella;Euro-House;Dance Hall;Goa;Drum & Bass;Club-House;Hardcore;Terror;Indie;BritPop;Negerpunk;Polsk Punk;Beat;Christian Gangsta Rap;Heavy Metal;Black Metal;Crossover;Contemporary Christian;Christian Rock;Merengue;Salsa;Thrash Metal;Anime;JPop;Synthpop;Rock/Pop".split(";");
g=function(c){this.type=c||"uri";this.file=this.size=null};g.prototype.open=function(c,a){this.file=c;var b=this;"local"===this.type?p.stat(this.file,function(c,d){if(c)return a(c);b.size=d.size;p.open(b.file,"r",function(d,c){if(d)return a(d);b.fd=c;a()})}):"file"===this.type?(this.size=this.file.size,a()):this.ajax({uri:this.file,type:"HEAD"},function(c,d,f){if(c)return a(c);b.size=parseInt(f.getResponseHeader("Content-Length"));a()})};g.prototype.close=function(){"local"===this.type&&p.close(this.fd)};
g.prototype.read=function(c,a,b){"local"===this.type?this.readPath(c,a,b):"file"===this.type?this.readFile(c,a,b):this.readUri(c,a,b)};g.prototype.readPath=function(c,a,b){var e=new Buffer(c);p.read(this.fd,e,0,c,a,function(a,c,e){if(a)return b(a);a=new ArrayBuffer(e.length);c=new Uint8Array(a);for(var g=0;g<e.length;g++)c[g]=e[g];b(null,a)})};g.prototype.ajax=function(c,a){var b={type:"GET",uri:null,responseType:"text"};"string"===typeof c&&(c={uri:c});for(var e in c)b[e]=c[e];var d=new XMLHttpRequest;
d.onreadystatechange=function(){if(4===d.readyState){if(200!==d.status&&206!==d.status)return a("Received non-200/206 response ("+d.status+")");a(null,d.response,d)}};d.responseType=b.responseType;d.open(b.type,b.uri,!0);b.range&&(b.range=[].concat(b.range),2===b.range.length?d.setRequestHeader("Range","bytes="+b.range[0]+"-"+b.range[1]):d.setRequestHeader("Range","bytes="+b.range[0]));d.send()};g.prototype.readUri=function(c,a,b){this.ajax({uri:this.file,type:"GET",responseType:"arraybuffer",range:[a,
a+c-1]},function(a,d){return a?b(a):b(null,d)})};g.prototype.readFile=function(c,a,b){c=this.file.slice(a,a+c);a=new FileReader;a.onload=function(a){b(null,a.target.result)};a.onerror=function(a){b("File read failed")};a.readAsArrayBuffer(c)};DataView.prototype.getString=function(c,a,b){a=a||0;c=c||this.byteLength-a;0>c&&(c+=this.byteLength);for(var e="",d=a;d<a+c;d++)e+=String.fromCharCode(this.getUint8(d));if(b)return e;c="";try{c=decodeURIComponent(escape(e))}catch(f){}return c};DataView.prototype.getStringUtf16=
function(c,a,b){a=a||0;c=c||this.byteLength-a;var e=!1,d="";0>c&&(c+=this.byteLength);b&&(65534===this.getUint16(a)&&(e=!0),a+=2,c-=2);for(b=a;b<a+c;b+=2){var f=this.getUint16(b,e);0<=f&&55295>=f||57344<=f&&65535>=f?d+=String.fromCharCode(f):65536<=f&&1114111>=f&&(f-=65536,d+=String.fromCharCode(((1047552&f)>>10)+55296)+String.fromCharCode((1023&f)+56320))}c="";try{c=decodeURIComponent(escape(d))}catch(g){}return c};DataView.prototype.getSynch=function(c){for(var a=0,b=2130706432;b;)a>>=1,a|=c&b,
b>>=8;return a};DataView.prototype.getUint32Synch=function(c){return this.getSynch(this.getUint32(c))};DataView.prototype.getUint24=function(c){return this.getUint8(c+2)+(this.getUint8(c+1)<<8)+(this.getUint8(c)<<16)};var n={types:{TALB:"album",TBPM:"bpm",TCOM:"composer",TCON:"genre",TCOP:"copyright",TDEN:"encoding-time",TDLY:"playlist-delay",TDOR:"original-release-time",TDRC:"recording-time",TDRL:"release-time",TDTG:"tagging-time",TENC:"encoder",TEXT:"writer",TFLT:"file-type",TIPL:"involved-people",
TIT1:"content-group",TIT2:"title",TIT3:"subtitle",TKEY:"initial-key",TLAN:"language",TLEN:"length",TMCL:"credits",TMED:"media-type",TMOO:"mood",TOAL:"original-album",TOFN:"original-filename",TOLY:"original-writer",TOPE:"original-artist",TOWN:"owner",TPE1:"artist",TPE2:"band",TPE3:"conductor",TPE4:"remixer",TPOS:"set-part",TPRO:"produced-notice",TPUB:"publisher",TRCK:"track",TRSN:"radio-name",TRSO:"radio-owner",TSOA:"album-sort",TSOP:"performer-sort",TSOT:"title-sort",TSRC:"isrc",TSSE:"encoder-settings",
TSST:"set-subtitle",TAL:"album",TBP:"bpm",TCM:"composer",TCO:"genre",TCR:"copyright",TDY:"playlist-delay",TEN:"encoder",TFT:"file-type",TKE:"initial-key",TLA:"language",TLE:"length",TMT:"media-type",TOA:"original-artist",TOF:"original-filename",TOL:"original-writer",TOT:"original-album",TP1:"artist",TP2:"band",TP3:"conductor",TP4:"remixer",TPA:"set-part",TPB:"publisher",TRC:"isrc",TRK:"track",TSS:"encoder-settings",TT1:"content-group",TT2:"title",TT3:"subtitle",TXT:"writer",WCOM:"url-commercial",
WCOP:"url-legal",WOAF:"url-file",WOAR:"url-artist",WOAS:"url-source",WORS:"url-radio",WPAY:"url-payment",WPUB:"url-publisher",WAF:"url-file",WAR:"url-artist",WAS:"url-source",WCM:"url-commercial",WCP:"url-copyright",WPB:"url-publisher",COMM:"comments",APIC:"image",PIC:"image",PRIV:"private"},imageTypes:"other file-icon icon cover-front cover-back leaflet media artist-lead artist conductor band composer writer location during-recording during-performance screen fish illustration logo-band logo-publisher".split(" "),
parse:function(c,a,b){a=a||4;b={tag:null,value:null};var e=new DataView(c);if(3>a)return n.parseLegacy(c);a=e.getString(4);var d=e.getString(1);e.getUint32Synch(4);if(0!==[e.getUint8(8),e.getUint8(9)][1]||!a in n.types)return!1;b.tag=n.types[a];if("T"===d){try{var f=e.getUint8(10)}catch(g){}if(0===f||3===f)b.value=e.getString(-11,11);else if(1===f)b.value=e.getStringUtf16(-11,11,!0);else if(2===f)b.value=e.getStringUtf16(-11,11);else return!1;"TCON"===a&&parseInt(b.value)&&(b.value=k[parseInt(b.value)])}else if("W"===
d)b.value=e.getString(-10,10);else if("COMM"===a){f=e.getUint8(10);d=0;for(d=14;;d++)if(1===f||2===f){if(0===e.getUint16(d)){a=d+2;break}d++}else if(0===e.getUint8(d)){a=d+1;break}if(0===f||3===f)b.value=e.getString(-1*a,a);else if(1===f)b.value=e.getStringUtf16(-1*a,a,!0);else if(2===f)b.value=e.getStringUtf16(-1*a,a);else return!1}else if("APIC"===a){e.getUint8(10);f={type:null,mime:null,description:null,data:null};for(d=a=11;;d++)if(0===e.getUint8(d)){d-=a;break}f.mime=e.getString(d,a);f.type=
n.imageTypes[e.getUint8(a+d+1)]||"other";for(d=a+=d+2;;d++)if(0===e.getUint8(d)){d-=a;break}f.description=0===d?null:e.getString(d,a);f.data=c.slice(a+1);b.value=f}else if("PRIV"===a){f={description:null,data:null};for(d=a=10;;d++)if(0===e.getUint8(d)){d-=a;break}f.description=0===d?null:e.getString(d,a);f.data=c.slice(d+a+1);b.value=f}return b.tag?b:!1},parseLegacy:function(c){var a={tag:null,value:null},b=new DataView(c),e=b.getString(3),d=b.getString(1);b.getUint24(3);if(!e in n.types)return!1;
a.tag=n.types[e];if("T"===d)b.getUint8(7),a.value=b.getString(-7,7),"TCO"===e&&parseInt(a.value)&&(a.value=k[parseInt(a.value)]);else if("W"===d)a.value=b.getString(-7,7);else if("COM"===e)b.getUint8(6),a.value=b.getString(-10,10),-1!==a.value.indexOf("\x00")&&(a.value=a.value.substr(a.value.indexOf("\x00")+1));else if("PIC"===e){b.getUint8(6);e={type:null,mime:"image/"+b.getString(3,7).toLowerCase(),description:null,data:null};e.type=n.imageTypes[b.getUint8(11)]||"other";d=0;for(d=11;;d++)if(0===
b.getUint8(d)){d-=11;break}e.description=0===d?null:b.getString(d,11);e.data=c.slice(12);a.value=e}return a.tag?a:!1}},r={parse:function(c,a){var b={title:null,album:null,artist:null,year:null,v1:{title:null,artist:null,album:null,year:null,comment:null,track:null,version:1},v2:{version:[null,null]}},e=!1,d=!1,f=function(c){e&&d&&(b.title=b.v2.title||b.v1.title,b.album=b.v2.album||b.v1.album,b.artist=b.v2.artist||b.v1.artist,b.year=b.v1.year,a(c,b))};c.read(128,c.size-128,function(a,d){if(a)return f("Could not read file");
var c=new DataView(d);if(128!==d.byteLength||"TAG"!==c.getString(3,null,!0))return e=!0,f();b.v1.title=c.getString(30,3).replace(/(^\s+|\s+$)/,"")||null;b.v1.artist=c.getString(30,33).replace(/(^\s+|\s+$)/,"")||null;b.v1.album=c.getString(30,63).replace(/(^\s+|\s+$)/,"")||null;b.v1.year=c.getString(4,93).replace(/(^\s+|\s+$)/,"")||null;0===c.getUint8(125)?(b.v1.comment=c.getString(28,97).replace(/(^\s+|\s+$)/,""),b.v1.version=1.1,b.v1.track=c.getUint8(126)):b.v1.comment=c.getString(30,97).replace(/(^\s+|\s+$)/,
"");b.v1.genre=k[c.getUint8(127)]||null;e=!0;f()});c.read(14,0,function(a,e){if(a)return f("Could not read file");var g=new DataView(e),h=10,k=0,l;if(14!==e.byteLength||"ID3"!==g.getString(3,null,!0)||4<g.getUint8(3))return d=!0,f();b.v2.version=[g.getUint8(3),g.getUint8(4)];l=g.getUint8(5);if(0!==(l&128))return d=!0,f();0!==(l&64)&&(h+=g.getUint32Synch(11));k+=g.getUint32Synch(6);c.read(k,h,function(a,c){if(a)return d=!0,f();for(var e=new DataView(c),g=0;g<c.byteLength;){for(var h,k,l=!0,m=0;3>m;m++)h=
e.getUint8(g+m),(65>h||90<h)&&(48>h||57<h)&&(l=!1);if(!l)break;3>b.v2.version[0]?k=c.slice(g,g+6+e.getUint24(g+3)):3===b.v2.version[0]?k=c.slice(g,g+10+e.getUint32(g+4)):4===b.v2.version[0]&&(k=c.slice(g,g+10+e.getUint32Synch(g+4)));if(h=n.parse(k,b.v2.version[0]))b.v2[h.tag]=h.value;g+=k.byteLength}d=!0;f()})})}},q=new g(l.type);q.open(l.file,function(c){if(c)return m("Could not open specified file");r.parse(q,function(a,b){m(a,b)})})};"undefined"!==typeof module&&module.exports?module.exports=k:
"function"===typeof define&&define.amd?define("id3",[],function(){return k}):window.id3=k})();
