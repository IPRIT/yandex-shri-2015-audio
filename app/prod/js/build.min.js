/*!
 * Yandex-Shri-2015-Audio-Player 
 * v0.0.1 - 2015-08-18 
 * Copyright (c) Aleksandr Belov
**/
"use strict";function initApplication(){ConfigStorage.get("i18n_locale",function(a){var b=a,c=Config.I18n.locale,d={dom:!1,i18n_ng:!1,i18n_messages:!1,i18n_fallback:!1},e=function(){var a,b=!0;for(a in d)if(d.hasOwnProperty(a)&&d[a]===!1){b=!1;break}b&&(d.boot=!1,angular.bootstrap(document,["Shri"]))};b||(b=c);for(var f=0;f<Config.I18n.supported.length;f++)if(Config.I18n.supported[f]==b){Config.I18n.locale=b;break}d.i18n_ng=!0,$.getJSON("app/js/locales/"+Config.I18n.locale+".json").success(function(a){Config.I18n.messages=a,d.i18n_messages=!0,console.log("Locale language has been loaded"),Config.I18n.locale==c&&(d.i18n_fallback=!0),e()}),Config.I18n.locale!==c&&$.getJSON("/js/locales/"+c+".json").success(function(a){Config.I18n.fallback_messages=a,d.i18n_fallback=!0,e()}),$(document).ready(function(){d.dom=!0,d.i18n_ng?e():$("<script>").appendTo("body").on("load",function(){d.i18n_ng=!0,e()})})})}function cancelEvent(a){return a=a||window.event,a&&(a=a.originalEvent||a,a.stopPropagation&&a.stopPropagation(),a.preventDefault&&a.preventDefault()),!1}function onCtrlEnter(a,b){$(a).on("keydown",function(a){return 13==a.keyCode&&(a.ctrlKey||a.metaKey)?(b(),cancelEvent(a)):void 0})}function safeReplaceObject(a,b){for(var c in a)b.hasOwnProperty(c)||"$"==c.charAt(0)||delete a[c];for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])}function listMergeSorted(a,b){a=a||[],b=b||[];for(var c=angular.copy(a),d=a.length?a[a.length-1]:4294967295,e=0;e<b.length;e++)b[e]<d&&c.push(b[e]);return c}function listUniqSorted(a){a=a||[];for(var b=[],c=!1,d=0;d<a.length;d++)a[d]!==c&&b.push(a[d]),c=a[d];return b}function templateUrl(a,b){var c="app/partials/"+a+"/"+b+".html";return console.log(c),c}function encodeEntities(a){return a.replace(/&/g,"&amp;").replace(/([^\#-~| |!])/g,function(a){return"&#"+a.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}angular.module("Shri",["ng","ngRoute","ngSanitize","ngMaterial","Shri.controllers","Shri.services","Shri.directives"]).config(["$locationProvider","$routeProvider","StorageProvider",function(a,b,c){Config.Modes.test&&c.setPrefix("t_"),a.hashPrefix("!"),b.when("/",{templateUrl:templateUrl("index","main"),controller:"IndexCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("Shri.controllers",["Shri.i18n"]).controller("PageCtrl",["$scope","_",function(a,b){var c=b("app_name");a.$on("change_title",function(b,d){a.title="undefined"!==d.title&&d.title.length?d.title:c,console.log("Title change listener")})}]).controller("AppCtrl",["$scope","$timeout","$interval",function(a,b,c){console.log("Works!")}]).controller("IndexCtrl",["$scope","_","AudioPlaylists","AudioPlayer","AudioTracks","$interval","$timeout","$mdDialog",function(a,b,c,d,e,f,g,h){f(function(){return a},10),a.$emit("change_title",{title:b("app_name_raw")}),a.tracks=[],a.loading=!1,a.changing=!1,a.playing=!1,a.curTrack=null,a.curState="stopped",a.curPanelState="hidden",a.trackIndex=0,a.isLoop=!1,g(function(){a.isLoop=d.isLoop()},100),a.toggleLoop=function(){d.toggleLoop(),a.isLoop=!a.isLoop},a.openFiles=function(b,c){function f(){return j[i]?void e.create(j[i],function(b){a.progress=b},function(b){b&&b.id&&a.tracks.push(b),i++,f(),d.fillAudioBuffer(b).then(function(){console.log("Successful decoded",b)})}):void(a.loading=!1)}var g,h,i=0;c?h=b:(g=b.target,h=g.files);for(var j=[],k=0;k<h.length;++k)h[k]&&h[k].type.match(/audio\//i)&&j.push(h[k]);return j.length?(f(),void(a.loading=!0)):void(a.loading=!1)},a.playTrack=function(b,c){if(!a.changing){if(a.curPanelState="opened",a.curTrack&&a.curTrack.id===b.id)return void("playing"===a.curState?a.pause():a.play());a.changing=!0,a.playing=!0,a.curTrack=b,a.curState="stopped",a.loading=!0;for(var e=0;e<a.tracks.length;++e)a.tracks[e].id===b.id&&(a.trackIndex=e);d.setTrack(b,function(){d.play(),a.changing=!1,a.curState=d.getCurPlayerState(),a.loading=!1,a.playing=!0})}},a.play=function(){a.curState="playing",d.play(!0)},a.pause=function(){a.curState="stopped",d.pause(!0)},a.openEqualizer=function(a){h.show({controller:"EqualizerCtrl",templateUrl:templateUrl("modals","settings"),parent:angular.element(document.querySelector(".modal-layer")),clickOutsideToClose:!0})},a.deleteTrack=function(b,c){console.log(a.tracks),a.curTrack&&a.curTrack.id===b.id&&(d.pause(!0),a.curTrack=null,a.curPanelState="closed");for(var e=0;e<a.tracks.length;++e)if(a.tracks[e].id===b.id){a.tracks.splice(e,1);break}},a.$on("track_ended",function(b,c){return a.curTrack=null,a.trackIndex>=a.tracks.length-1&&!d.isLoop()?void a.pause():(d.isLoop()||a.trackIndex++,void g(function(){a.playTrack(a.tracks[a.trackIndex])},100))});var i=new Waveform({container:document.querySelector(".player__waveform"),innerColor:"#3F51B5"});g(function(){d.setAudioVisualisationFallback(function(a){i.update({data:a})})},1e3)}]).controller("EqualizerCtrl",["$scope","$mdDialog","AudioPlayer","_",function(a,b,c,d){var e=c.getAvailableFilters(),f=[];for(var g in e)f.push({id:g,name:d("filter_"+g+"_raw")});a.filters=f,a.curFilter=c.getSettings().filter,a.save=function(){b.hide()},a.closeWindow=function(){b.hide()},a.selectFilter=function(b){a.curFilter=b.id,c.setFilter(b.id)}}]),angular.module("Shri.directives",[]).directive("mySubmitOnEnter",function(){function a(a,b,c){b.on("keydown",function(a){13==a.keyCode&&b.trigger("submit")})}return{link:a}}).directive("droppable",["_",function(a){return{link:function(b,c){var d=c[0],e=angular.element(d),f=e.find(".dropzone__message")[0];d.addEventListener("dragover",function(b){return b.preventDefault&&b.preventDefault(),angular.element(d).addClass("droppable_over"),f.innerHTML=a("draggable_message_could_drop_raw"),!1},!1),d.addEventListener("dragleave",function(b){return b.preventDefault&&b.preventDefault(),angular.element(d).removeClass("droppable_over"),f.innerHTML=a("draggable_message_raw"),!1},!1),d.addEventListener("dragenter",function(b){return b.preventDefault&&b.preventDefault(),angular.element(d).addClass("droppable_over"),f.innerHTML=a("draggable_message_could_drop_raw"),!1},!1),d.addEventListener("drop",function(c){return c.preventDefault&&c.preventDefault(),angular.element(d).removeClass("droppable_over"),f.innerHTML=a("draggable_message_raw"),b.openFiles(c.dataTransfer.files,!0),!1},!1),d.addEventListener("click",function(a){var b=document.querySelector("#files_input");return b.click(),!1},!1)}}}]);var Config=window.Config=window.Config||{};Config.Modes={test:location.search.indexOf("test=1")>0,debug:location.search.indexOf("debug=1")>0},Config.Navigator={osX:-1!=(navigator.platform||"").toLowerCase().indexOf("mac")||-1!=(navigator.userAgent||"").toLowerCase().indexOf("mac"),retina:window.devicePixelRatio>1,ffos:-1!=navigator.userAgent.search(/mobi.+Gecko/i),touch:screen.width<=768,opera:-1!=navigator.userAgent.search(/opr|opera/i),mobile:screen.width&&screen.width<480||-1!=navigator.userAgent.search(/iOS|iPhone OS|Android|BlackBerry|BB10|Series ?[64]0|J2ME|MIDP|opera mini|opera mobi|mobi.+Gecko|Windows Phone/i)},Config.I18n={locale:"ru-ru",supported:["ru-ru"],languages:{"ru-ru":"Русский"},aliases:{ru:"ru-ru"},aliases_back:{"ru-ru":"ru"},messages:{},fallback_messages:{}},function(a){function b(a){h=a}function c(){i=!0}function d(){return i?(i=!1,""):h}function e(){var a,b,c,e=Array.prototype.slice.call(arguments),f=e.pop(),g=[],h=1==e.length,i=!0,m=d();for(b=0;b<e.length;b++)if(c=e[b]=m.toString()+e[b],l){try{a=localStorage.getItem(c)}catch(n){l=!1}try{a=void 0===a||null===a?!1:JSON.parse(a)}catch(n){a=!1}g.push(j[c]=a)}else k?i=!1:g.push(j[c]=!1);return i?f(h?g[0]:g):void 0}function f(a,b){var c,e,f={},g=d();for(c in a)if(a.hasOwnProperty(c))if(e=a[c],c=g+c,j[c]=e,e=JSON.stringify(e),l)try{localStorage.setItem(c,e)}catch(h){l=!1}else f[c]=e;(l||!k)&&b&&b()}function g(){var a,b,c,e=Array.prototype.slice.call(arguments),f=d();for("function"==typeof e[e.length-1]&&(c=e.pop()),a=0;a<e.length;a++)if(b=e[a]=f+e[a],delete j[b],l)try{localStorage.removeItem(b)}catch(g){l=!1}c&&c()}var h="",i=!1,j={},k=!1,l=!k&&!!a.localStorage;a.ConfigStorage={prefix:b,noPrefix:c,get:e,set:f,remove:g}}(window),initApplication(),angular.module("Shri.i18n",[]).factory("_",["$rootScope","$locale",function(a,b){function c(a,b){return a.replace(i,function(d,e,f){var g=b[e];return void 0===g?(console.warn("[i18n] missing param "+e+' for message "'+a+'"'),""):(void 0!==f&&(g=c(g,f.split("|"))),g.toString().trim())})}function d(a,b){return a=a.replace(/\*\*(.+?)\*\*/g,"<strong>$1</strong>").replace(/\n|&#10;/g,"<br/>")}function e(a,b){var e=!1,i=a;if("_raw"===a.substr(-4)&&(e=!0,a=a.substr(0,a.length-4)),g.hasOwnProperty(a))i=g[a];else{if(!h.hasOwnProperty(a))return console.warn("[i18n] missing key "+a),a;i=h[a],console.warn("[i18n] missing locale key "+f+" / "+a)}return e||(i=encodeEntities(i)),"_md"==a.substr(-3)&&(i=d(i)),arguments.length>1&&("string"==typeof b?(Array.prototype.shift.apply(arguments),i=c(i,arguments)):i=c(i,b)),i}var f=Config.I18n.locale,g=Config.I18n.messages,h=Config.I18n.fallback_messages,i=/\{\s*([a-zA-Z\d\-_]+)(?:\s*:\s*(.*?))?\s*\}/g;return e.locale=function(){return f},e.pluralize=function(c){var d=a.$eval(e(c+"_raw"));return function(a){return(d[b.pluralCat(a)]||"").replace("{}",a)}},e}]).filter("i18n",["_",function(a){return function(b,c){return a(b+"_raw",c)}}]).directive("ngPluralize",["_",function(a){return{restrict:"EA",priority:1,compile:function(b){var c=b.attr("when"),d=a(c+"_raw");b.attr("when",d)}}}]).directive("shriI18n",["_",function(a){return{restrict:"EA",compile:function(b){var c=b.children('shri-i18n-param:not([name]), [shri-i18n-param=""]:not([name])').map(function(a,b){return b.outerHTML}).toArray();b.children('shri-i18n-param[name], [shri-i18n-param]:not([shri-i18n-param=""]), [shri-i18n-param][name]').each(function(a,b){c[angular.element(b).attr("shri-i18n-param")||angular.element(b).attr("name")]=b.outerHTML}),b.children("shri-i18n-param").remove();var d=b.attr("shri-i18n")||b.attr("msgid")?b:b.children("shri-i18n-format, [shri-i18n-format]");d.each(function(b,d){var e=angular.element(d),f=e.attr("shri-i18n")||e.attr("msgid")||e.attr("shri-i18n-format")||e.html().replace(/\s+/g," ").trim(),g=a(f,c);e.html(g)})}}}]),function(a){for(var b,c,d={},e=function(){},f="memory".split(","),g="assert,count,debug,dir,dirxml,error,exception,group,groupCollapsed,groupEnd,info,log,markTimeline,profile,profileEnd,time,timeEnd,trace,warn".split(",");b=f.pop();)a[b]=a[b]||d;for(;c=g.pop();)a[c]=a[c]||e}(this.console=this.console||{}),Array.prototype.indexOf||(Array.prototype.indexOf=function(a,b){var c;if(null==this)throw new TypeError('"this" is null or not defined');var d=Object(this),e=d.length>>>0;if(0===e)return-1;var f=+b||0;if(Math.abs(f)===1/0&&(f=0),f>=e)return-1;for(c=Math.max(f>=0?f:e-Math.abs(f),0);e>c;){if(c in d&&d[c]===a)return c;c++}return-1}),Array.isArray||(Array.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)}),"function"!=typeof Object.create&&(Object.create=function(){var a=function(){};return function(b){if(arguments.length>1)throw Error("Second argument not supported");if("object"!=typeof b)throw TypeError("Argument must be an object");a.prototype=b;var c=new a;return a.prototype=null,c}}()),Function.prototype.bind||(Function.prototype.bind=function(a){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var b=Array.prototype.slice.call(arguments,1),c=this,d=function(){},e=function(){return c.apply(this instanceof d&&a?this:a,b.concat(Array.prototype.slice.call(arguments)))};return d.prototype=this.prototype,e.prototype=new d,e}),function(a){function b(b){d.push(b),a.postMessage(e,"*")}function c(b){if(b.source==a&&b.data==e&&(b.stopPropagation(),d.length>0)){var c=d.shift();c()}}var d=[],e="zero-timeout-message";a.addEventListener("message",c,!0);var f=a.setTimeout;a.setTimeout=function(a,c){return!c||5>=c?b(a):f(a,c)},a.setZeroTimeout=b}(this);var Waveform=function(){function a(a){if(this.container=a.container,this.canvas=a.canvas,this.data=a.data||[],this.outerColor=a.outerColor||"transparent",this.innerColor=a.innerColor||"#000000",this.interpolate=a.interpolate!==!1,null==this.canvas){if(!this.container)throw"Either canvas or container option must be passed";this.canvas=this.createCanvas(this.container,a.width||this.container.clientWidth,a.height||this.container.clientHeight)}this.patchCanvasForIE(this.canvas),this.context=this.canvas.getContext("2d"),this.width=parseInt(this.context.canvas.offsetWidth,10),this.height=parseInt(this.context.canvas.offsetHeight,10),a.data&&this.setData(a.data),this.redraw()}a.prototype.setData=function(a){return this.data=a},a.prototype.setDataInterpolated=function(a){return this.setData(this.interpolateArray(a,this.context.canvas.offsetWidth))},a.prototype.setDataCropped=function(a){return this.setData(this.expandArray(a,this.context.canvas.offsetWidth))};var b=!1;return a.prototype.update=function(a){this.data=a.data},a.prototype.redraw=function(){var a=this;b=requestAnimationFrame(a.redraw.bind(a));var c=256;this.context.fillStyle="white",this.context.fillRect(0,0,this.context.canvas.offsetWidth,this.context.canvas.offsetHeight);for(var d,e=this.context.canvas.offsetWidth/c*2.5,f=-100,g=0;c>g;g++)d=this.data[g]/2,this.context.fillStyle="rgb(63,81,181)",this.context.fillRect(f,this.context.canvas.offsetHeight-d/2,e,d/2),f+=e+1},a.prototype.clear=function(){return this.context.fillStyle=this.outerColor,this.context.clearRect(0,0,this.context.canvas.offsetWidth,this.context.canvas.offsetHeight),this.context.fillRect(0,0,this.context.canvas.offsetWidth,this.context.canvas.offsetHeight)},a.prototype.patchCanvasForIE=function(a){var b;return"undefined"!=typeof window.G_vmlCanvasManager?(a=window.G_vmlCanvasManager.initElement(a),b=a.getContext,a.getContext=function(c){var d;return d=b.apply(a,arguments),a.getContext=b,d}):void 0},a.prototype.createCanvas=function(a,b,c){var d;return d=document.createElement("canvas"),a.appendChild(d),d.width=b,d.height=c,d.style.width="100%",d.style.height="100%",d},a.prototype.expandArray=function(a,b,c){var d,e,f,g;if(null==c&&(c=0),e=[],a.length>b)e=a.slice(a.length-b,a.length);else for(d=f=0,g=b-1;g>=0?g>=f:f>=g;d=g>=0?++f:--f)e[d]=a[d]||c;return e},a.prototype.linearInterpolate=function(a,b,c){return a+(b-a)*c},a.prototype.interpolateArray=function(a,b){var c,d,e,f,g,h,i;for(g=new Array,h=new Number((a.length-1)/(b-1)),g[0]=a[0],f=1;b-1>f;)i=f*h,e=new Number(Math.floor(i)).toFixed(),c=new Number(Math.ceil(i)).toFixed(),d=i-e,g[f]=this.linearInterpolate(a[e],a[c],d),f++;return g[b-1]=a[a.length-1],g},a}();angular.module("Shri.services",["Shri.i18n"]).provider("Storage",function(){this.setPrefix=function(a){ConfigStorage.prefix(a)},this.$get=["$q",function(a){var b={};return angular.forEach(["get","set","remove"],function(c){b[c]=function(){var b=a.defer(),d=Array.prototype.slice.call(arguments);return d.push(function(a){b.resolve(a)}),ConfigStorage[c].apply(ConfigStorage,d),b.promise}}),b}]}).service("StorageObserver",["Storage",function(a){function b(){var a=Array.prototype.slice.call(arguments);return c.apply(this,a)}var c=function(b,c,d){function e(a){clearInterval(g),a&&c(f)}d=d||{};var f,g,h=d.destroy||!1,i=d.timeout||50,j=d.deleteAfter||!1;return a.get(b).then(function(a){f=a}),g=setInterval(function(){a.get(b).then(function(d){f!=d&&(c(d,f),(h||j)&&(clearInterval(g),j&&a.remove(b)),f=d)})},i),{stopWatching:e}};return{watch:b}}]).service("AudioPlaylists",["Storage","$q",function(a,b){function c(f){if(!n)return e().then(function(){c(f)});var g=b.defer(),h=d();return f&&"string"==typeof f?(l[h]={id:h,name:f,tracks:[],timestamp:(new Date).getTime()},a.set({audio_playlists:l}).then(function(){g.resolve(h)}),g.promise):g.reject()}function d(){return(1e3*Math.random()).toString(16).replace(".","_")}function e(){var c=b.defer();return n?c.resolve():(a.get(m).then(function(a){return a&&angular.isObject(a)?(l=a,n=!0,c.resolve()):(l={},void i().then(function(){c.resolve()}))}),c.promise)}function f(a){function c(){return l[a]?void d.resolve(l[a]):d.resolve(null)}var d=b.defer();return n?(c(),d.promise):(e().then(function(){c()}),d.promise)}function g(a){function c(){var b=Object.keys(l),c=[];[].forEach.call(b,function(b){l[b].name===a&&c.push(l[b])}),d.resolve(c.length?1===c.length?c[0]:c:null)}var d=b.defer();return n?(c(),d.promise):(e().then(function(){c()}),d.promise)}function h(a){function c(){if(!l[a])return d.resolve(null);var b=l[a];l[a]=null,delete l[a],i().then(function(){d.resolve(b)})}var d=b.defer();return n?(c(),d.promise):(e().then(function(){c()}),d.promise)}function i(){var c=b.defer();return a.set({audio_playlists:l}).then(function(){c.resolve()}),c.promise}function j(a,c){function d(){var b=angular.copy(l);l={},i().then(function(){if(a){if(c)return f.resolve(b);var d=Object.keys(b),e=[];return[].forEach.call(d,function(a){e.push(b[a])}),f.resolve(e)}f.resolve()})}var f=b.defer();return n?(d(),f.promise):(e().then(function(){d()}),f.promise)}function k(a){function c(){if(a)return d.resolve(l);var b=Object.keys(l),c=[];[].forEach.call(b,function(a){c.push(l[a])}),d.resolve(c)}var d=b.defer();return n?(c(),d.promise):(e().then(function(){c()}),d.promise)}var l,m="audio_playlists",n=!1;return{create:c,getById:f,getByName:g,getAll:k,deleteById:h,clearAll:j}}]).service("AudioPlayer",["Storage","$q","$mdDialog","_","$rootScope",function(a,b,c,d,e){function f(){var c=b.defer();return a.get("audio_settings").then(function(a){return a?void c.resolve(K=a):(K={curVolume:1,loop:!1,filter:"normal"},g().then(function(){c.resolve(K)}))}),c.promise}function g(){var c=b.defer();return a.set({audio_settings:K}).then(function(){c.resolve()}),c.promise}function h(a){L=a}function i(a,b){if(!P){var c=!1;"playing"===N&&(l(!0),c=!0),P=!0,j(F,a,c,b)}}function j(a,b,e,f){var g=b.audioBuffer;if(g)B.disconnect(),B=A.createBufferSource(),B.onended=x,B.buffer=b.audioBuffer,B.connect(C[0]),F=b,R=0,P=!1,f&&f();else{if(!b.arrayBuffer)return P=!1,e&&k(!0),void(f&&f());O=!0,b.isDecoding=!0,A.decodeAudioData(b.arrayBuffer,function(a){l(!0),B.disconnect(),B=A.createBufferSource(),B.onended=x,B.buffer=a,B.connect(C[0]),b.audioBuffer=a,b.arrayBuffer=null,b.isDecoding=!1,F=b,R=0,P=!1,O=!1,e&&k(!0),f&&f()},function(){Config.Navigator.opera&&c.show(c.alert().parent(angular.element(document.querySelector(".view"))).clickOutsideToClose(!0).title(d("file_not_found")).content(d("opera_error")).ariaLabel("Alert Dialog").ok(d("close_button_text_raw")).targetEvent(ev))})}}function k(a){function b(){P||O||(I=A.currentTime,B.disconnect(),B=A.createBufferSource(),B.onended=x,B.buffer=F.audioBuffer,B.connect(C[0]),B.start(0,R),N="playing",console.log("Audio Player: playing",F))}if(("stopped"===N||H)&&F&&!O&&!P){if(a)return clearInterval(H),b();if(H&&(clearInterval(H),H=null),b(),Math.abs(E.gain.value-K.curVolume)>-1e6){var c=E.gain.value;H=setInterval(function(){return c+=.05,c>=K.curVolume?(E.gain.value=K.curVolume,clearInterval(H),void(H=null)):void(E.gain.value=c)},Q)}}}function l(a){function b(){R+=A.currentTime-I,B.stop(0),B.disconnect(),N="stopped",console.log("Audio Player: paused",F)}if("playing"===N&&F){if(a)return clearInterval(H),b();H&&(clearInterval(H),H=null);var c=E.gain.value;H=setInterval(function(){return c-=.05,0>=c?(E.gain.value=0,b(),clearInterval(H),void(H=null)):void(E.gain.value=c)},Q)}}function m(){return J&&F&&!O}function n(){return K}function o(a){K.curVolume=a,g()}function p(a){K.filter=a,g(),w(a)}function q(a){K.loop=a||!K.loop,g()}function r(){return R}function s(){return K.loop}function t(){return F}function u(){return N}function v(){return{classic:[{f:60,Q:1,gain:0,type:"peaking"},{f:170,Q:1,gain:0,type:"peaking"},{f:310,Q:1,gain:0,type:"peaking"},{f:600,Q:1,gain:0,type:"peaking"},{f:1e3,Q:1,gain:0,type:"peaking"},{f:3e3,Q:1,gain:0,type:"peaking"},{f:6e3,Q:1,gain:-4,type:"peaking"},{f:12e3,Q:1,gain:-4,type:"peaking"},{f:14e3,Q:1,gain:-4,type:"peaking"},{f:16e3,Q:1,gain:-4,type:"peaking"}],pop:[{f:60,Q:1,gain:0,type:"peaking"},{f:170,Q:1,gain:2,type:"peaking"},{f:310,Q:1,gain:4,type:"peaking"},{f:600,Q:1,gain:5,type:"peaking"},{f:1e3,Q:1,gain:3,type:"peaking"},{f:3e3,Q:1,gain:0,type:"peaking"},{f:6e3,Q:1,gain:0,type:"peaking"},{f:12e3,Q:1,gain:0,type:"peaking"},{f:14e3,Q:1,gain:1,type:"peaking"},{f:16e3,Q:1,gain:0,type:"peaking"}],rock:[{f:60,Q:1,gain:4,type:"peaking"},{f:170,Q:1,gain:2,type:"peaking"},{f:310,Q:1,gain:-2,type:"peaking"},{f:600,Q:1,gain:-5,type:"peaking"},{f:1e3,Q:1,gain:-1,type:"peaking"},{f:3e3,Q:1,gain:2,type:"peaking"},{f:6e3,Q:1,gain:4,type:"peaking"},{f:12e3,Q:1,gain:6,type:"peaking"},{f:14e3,Q:1,gain:6,type:"peaking"},{f:16e3,Q:1,gain:5.8,type:"peaking"}],jazz:[{f:60,Q:1,gain:2,type:"peaking"},{f:170,Q:1,gain:0,type:"peaking"},{f:310,Q:1,gain:-1,type:"peaking"},{f:600,Q:1,gain:-1,type:"peaking"},{f:1e3,Q:1,gain:0,type:"peaking"},{f:3e3,Q:1,gain:2,type:"peaking"},{f:6e3,Q:1,gain:4,type:"peaking"},{f:12e3,Q:1,gain:5,type:"peaking"},{f:14e3,Q:1,gain:6,type:"peaking"},{f:16e3,Q:1,gain:7,type:"peaking"}],normal:[{f:60,Q:1,gain:0,type:"peaking"},{f:170,Q:1,gain:0,type:"peaking"},{f:310,Q:1,gain:0,type:"peaking"},{f:600,Q:1,gain:0,type:"peaking"},{f:1e3,Q:1,gain:0,type:"peaking"},{f:3e3,Q:1,gain:0,type:"peaking"},{f:6e3,Q:1,gain:0,type:"peaking"},{f:12e3,Q:1,gain:0,type:"peaking"},{f:14e3,Q:1,gain:0,type:"peaking"},{f:16e3,Q:1,gain:0,type:"peaking"}]}}function w(a){function b(a){var b=A.createBiquadFilter();return b.type=a.type,b.frequency.value=a.f,b.frequency.Q=a.Q,b.gain.value=a.gain,b}var c=v()[a];if(Array.isArray(c)){var d=c.map(b);d.reduce(function(a,b){return a.connect(b),b}),C=d,B.disconnect(),B.connect(C[0]),C[C.length-1].connect(D)}}function x(){e.$broadcast("track_ended",{track:F})}function y(a){if(a){var c=b.defer(),d={promise:c,onLoaded:function(){this.promise.resolve(this.track)},track:a};return U>=V?T.push(d):(U++,z(d)),c.promise}}function z(a){a.track.isDecoding=!0,console.log("Start decoding track",a.track),A.decodeAudioData(a.track.arrayBuffer,function(b){return a.track?(a.track.audioBuffer||(a.track.audioBuffer=b),a.track.arrayBuffer=null,a.track.isDecoding=!1,a.onLoaded(),W++,void(T.length&&X>W?setTimeout(function(){z(T.shift())},500):U--)):void U--})}var A,B,C,D,E,F,G,H,I,J=!1,K={},L=angular.noop,M=30,N="stopped",O=!1,P=!1,Q=30,R=0,S=!1,T=[],U=0,V=5,W=0,X=10;return function(){if(!J){A=new(window.AudioContext||window.webkitAudioContext),B=A.createBufferSource(),B.onended=x,E=A.createGain(),D=A.createAnalyser(),D.fftSize=256;var a=new Uint8Array(D.frequencyBinCount);G=setInterval(function(){J&&L!==angular.noop&&"stopped"!==N&&("stopped"===N?a=new Uint8Array(D.frequencyBinCount):D.getByteFrequencyData(a),L(a))},M),B.connect(D),D.connect(E),E.connect(A.destination),f().then(function(){E.gain.value=K.curVolume||1,B.loop=!!K.loop,w(K.filter||"normal"),J=!0,console.log("Audio Service has been initialized.")}),Config.Navigator.opera&&!S&&(c.show(c.alert().parent(angular.element(document.querySelector(".view"))).clickOutsideToClose(!0).title(d("warning_title_raw")).content(d("opera_error_raw")).ariaLabel("Alert Dialog").ok(d("try_force_raw"))),S=!0)}}(),{setAudioVisualisationFallback:h,setTrack:i,play:k,pause:l,canPlay:m,getSettings:n,setVolume:o,toggleLoop:q,getOffsetTime:r,isLoop:s,getCurTrack:t,getCurPlayerState:u,getAvailableFilters:v,setFilter:p,fillAudioBuffer:y}}]).service("AudioTracks",["Storage","$q","_","$mdDialog",function(a,b,c,d){function e(){return(1e3*Math.random()).toString(16).replace(".","_")}function f(a,b,d){function f(){var f=new FileReader;f.onerror=g,f.onprogress=h.bind(this,b),f.addEventListener("load",function(b){var f=b.target.result,g={id:e(),name:j||a.name,artist:i||c("unknown_artist_raw"),duration:0,originalName:a.name,photo:"nope",arrayBuffer:f,audioBuffer:null,isDecoding:!1};d(g)}),f.readAsArrayBuffer(a)}var i,j;try{id3(a,function(a,b){i=b.artist,j=b.title,f()})}catch(k){console.log(k),f()}}function g(a){switch(a.target.error.code){case a.target.error.NOT_FOUND_ERR:d.show(d.alert().parent(angular.element(document.querySelector(".view"))).clickOutsideToClose(!0).title(c("file_not_found_raw")).content(c("file_not_found_error_raw")).ariaLabel("Alert Dialog").ok(c("close_button_text")));break;case a.target.error.NOT_READABLE_ERR:d.show(d.alert().parent(angular.element(document.querySelector(".view"))).clickOutsideToClose(!0).title(c("file_not_found_raw")).content(c("file_not_readable_error_raw")).ariaLabel("Alert Dialog").ok(c("close_button_text_raw")));break;case a.target.error.ABORT_ERR:break;default:d.show(d.alert().parent(angular.element(document.querySelector(".view"))).clickOutsideToClose(!0).title(c("file_not_found_raw")).content(c("unknown_error_content_raw")).ariaLabel("Alert Dialog").ok(c("close_button_text_raw")))}}function h(a,b){b.lengthComputable&&a(Math.round(b.loaded/b.total*100))}function i(a){return n[a.id]?n[a.id]:void(n[a.id]=a)}function j(){var a=[];for(var b in n)a.push(n[b]);return a}function k(a){return"string"==typeof a&&n[a]?n[a]:null}function l(a){"string"==typeof a&&n[a]&&(n[a]=null,delete n[a])}function m(){n=Object.create(null)}var n=Object.create(null);return{create:f,add:i,getAll:j,getById:k,deleteById:l,deleteAll:m}}]);var AudioTrack={id:String,name:String,artist:String,duration:"Float",originalName:String,photo:String,arrayBuffer:"ArrayBuffer",audioBuffer:"AudioBuffer"};
//# sourceMappingURL=build.min.js.map